# 项目开发记录

## 基本原则
- 请在工作开始前确保正确加载应用全部规则
- 本记录仅存放本次任务的重要信息 

## 需求分析
需求：创建两个版本的插件界面：一个使用简体中文，另一个使用繁体中文。
目标：允许用户在简体中文和繁体中文之间进行切换，且设置能够被保存。

## 工作计划

### 确定技术方案
✅ 经评估后选择采用方案B：创建单一DLL，内置语言切换功能。这样可以：
- 提供更好的用户体验，支持运行时切换语言
- 简化维护工作，避免维护两个不同版本的DLL
- 减少安装复杂度，用户无需根据语言选择不同版本

1. **设计语言系统框架**
   - ✅ 分析现有代码，了解用户界面实现方式
   - ⏱️ 设计一个多语言支持系统，创建Language命名空间
   - ⏱️ 创建语言资源文件，分别存储简体中文和繁体中文字符串

2. **实现语言切换机制**
   - ⏱️ 创建一个语言管理器类（LanguageManager）
      - 负责加载语言资源文件
      - 提供获取字符串的接口
      - 处理语言切换事件
   - ⏱️ 在Config中添加语言设置选项（"Language": "SC"或"TC"）
   - ⏱️ 实现语言切换接口和回调机制，在切换语言后通知UI刷新

3. **用户界面适配**
   - ⏱️ 修改所有UI相关代码，使用语言资源而不是硬编码字符串
   - ⏱️ 在GameSettings模块中添加语言切换选项
   - ⏱️ 确保界面元素在切换语言后正确刷新和重新布局

4. **文本转换实现**
   - ⏱️ 研究并选择最合适的简繁转换方式
     - 选项1: 实现内置简繁转换函数
     - 选项2: 使用预先准备的两套完整文本资源（推荐）
   - ⏱️ 实现资源文件加载和管理机制

## 规范事项

1. **资源文件规范**
   - 使用JSON格式存储字符串资源：`strings_sc.json`, `strings_tc.json`
   - 文件编码必须为UTF-8，确保中文正常显示
   - 资源文件放置在`/resources/`目录下

2. **代码实现规范**
   - 所有界面文本通过语言管理器获取，避免硬编码
   - 提供统一的文本获取接口：`Language::GetString(StringID id)`
   - 确保字符编码使用UTF-8，防止中文乱码
   - 保持代码注释的双语一致性
   - 确保字体支持简繁中文显示

3. **配置项规范**
   - 在BH.cfg中添加"Language"选项，值为"SC"或"TC"
   - 首次启动时根据系统区域设置默认语言
   - 提供用户友好的界面切换选项

## 下一步任务

1. ⏱️ **创建语言资源系统**
   - 创建Language.h和Language.cpp文件
   - 设计字符串ID枚举表（如UIString::SETTINGS_TITLE等）
   - 定义语言管理接口和实现
   ```cpp
   // Language.h示例
   namespace Language {
       enum StringID {
           SETTINGS_TITLE,
           GENERAL_TAB,
           // ... 其他字符串ID
       };
       
       void Initialize();
       void SetLanguage(const std::string& lang); // "SC" 或 "TC"
       std::string GetString(StringID id);
       std::string GetCurrentLanguage();
       void RegisterChangeCallback(void (*callback)());
   }
   ```

2. ⏱️ **提取所有界面文本**
   - 从现有代码中提取所有硬编码文本
   - 整理为字符串ID和对应的文本值
   - 创建简体中文资源文件
   - 创建或转换繁体中文资源文件

3. ⏱️ **实现设置界面**
   - 在GameSettings模块中添加"语言"选项
   - 添加简体/繁体中文切换按钮
   - 实现切换语言后的界面刷新逻辑

4. ⏱️ **UI代码修改**
   - 修改Drawing/UI目录下的代码，使用Language::GetString替换硬编码字符串
   - 修改所有模块的UI初始化代码，使用语言资源

## 进度跟踪

⚙️ **分析阶段**
- ✅ 完成代码库初步分析
- ✅ 理解用户界面实现方式
- ✅ 确定核心修改点
- ✅ 选定技术方案B：单一DLL内置语言切换功能

## 重要信息

1. **关键文件**:
   - BH.h/BH.cpp：插件主入口
   - Config.h/Config.cpp：配置系统
   - Drawing/UI：用户界面系统
   - Modules/GameSettings：设置界面

2. **技术方案**:
   - ✅ 已选定方案B：创建单一DLL，内置语言切换功能
   - ❌ 方案A：创建两个独立的DLL文件（一个简体、一个繁体）

3. **修改点分析**:
   - 需要修改硬编码的文本显示方式
   - 需要添加语言配置项
   - 需要实现语言资源加载机制
   - 可能需要调整UI布局以适应不同长度的文本

4. **简繁转换方法**:
   - 推荐：预先准备两套完整的文本资源文件，避免运行时转换可能的问题
   - 备选：使用预定义映射表进行字符转换
   - 备选：使用OpenCC等开源库进行转换

## 错误处理方案


