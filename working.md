# 项目开发记录

## 基本原则
- 请在工作开始前确保正确加载应用全部规则
- 本记录仅存放本次任务的重要信息 

## 需求分析
需求：创建两个版本的插件界面：一个使用简体中文，另一个使用繁体中文。
目标：允许用户在简体中文和繁体中文之间进行切换，且设置能够被保存。

## 工作计划

### 确定技术方案
✅ 经评估后选择采用方案A：创建两个独立的DLL文件（一个简体、一个繁体）。这样可以：
- 简化实现难度，避免复杂的运行时语言切换系统
- 确保界面字符串的稳定性
- 让用户根据需要安装对应语言版本

1. **创建两个版本的代码基础**
   - ✅ 分析现有代码，了解用户界面实现方式
   - ✅ 建立两个不同的构建目标：BH_SC.dll 和 BH_TC.dll
   - ✅ 规划共享代码和语言特定代码的文件结构

2. **处理文本资源**
   - ✅ 从现有代码中提取所有硬编码文本
   - ✅ 创建简体中文版本的字符串常量
   - ✅ 创建对应的繁体中文版本字符串常量
   - ✅ 设计编译时语言切换机制（如使用预处理器宏）

3. **实现编译系统**
   - ✅ 配置两个不同的构建目标
   - ✅ 创建针对不同语言版本的资源文件
   - ✅ 实现自动构建脚本，一次性生成两个版本的DLL
   - ✅ 更新解决方案配置，支持在Visual Studio中直接构建两个版本

4. **改进安装体验**
   - ✅ 设计安装程序/说明，引导用户选择合适的语言版本
   - ✅ 准备两种语言的安装说明文档

## 规范事项

1. **代码组织规范**
   - ✅ 使用条件编译（#ifdef LANG_SC / #ifdef LANG_TC）来区分两个版本的代码
   - ✅ 避免代码重复，尽可能使用共享代码
   - ✅ 所有界面文本使用常量定义，集中管理

2. **代码实现规范**
   - ✅ 在UIString.h中定义所有UI文本常量
   - ✅ 简体版本使用UIString_SC.h，繁体版本使用UIString_TC.h
   - ✅ 确保字符编码使用UTF-8，防止中文乱码
   - ✅ 保持代码注释的双语一致性

3. **构建规范**
   - ✅ 创建两个构建配置：ReleaseSimplified和ReleaseTraditional
   - ✅ 确保生成的DLL文件名称明确区分语言版本
   - ✅ 提供多种方式生成两个版本：命令行批处理、VS批处理、VS外部工具

## 下一步任务

1. ⏱️ **测试两个语言版本**
   - 测试简体中文版本的UI文本显示
   - 测试繁体中文版本的UI文本显示
   - 确保两个版本的功能一致性

2. ⏱️ **完善更多UI界面的翻译**
   - 继续添加其他模块的字符串常量
   - 将所有硬编码字符串替换为常量引用

3. ⏱️ **优化构建流程**
   - ✅ 改进构建脚本，支持增量构建
   - ✅ 添加Visual Studio集成的构建方式
   - ⏱️ 考虑添加CI/CD支持

4. ⏱️ **文档完善**
   - ✅ 更新项目README.md，添加多语言支持说明
   - ✅ 为开发人员准备文档，说明如何添加新的翻译字符串
   - ✅ 添加Visual Studio工具使用说明

## 进度跟踪

✅ **分析阶段**
- ✅ 完成代码库初步分析
- ✅ 理解用户界面实现方式
- ✅ 确定核心修改点
- ✅ 选定技术方案A：创建两个独立的DLL文件（一个简体、一个繁体）

✅ **实施阶段**
- ✅ 创建基础字符串资源结构
- ✅ 创建简体中文和繁体中文字符串资源文件
- ✅ 修改项目配置，支持两个不同的构建目标
- ✅ 修改GameSettings模块，使用字符串常量
- ✅ 创建自动构建脚本
- ✅ 编写用户使用说明文档
- ✅ 优化Visual Studio构建体验，支持直接在VS中构建两个版本

## 重要信息

1. **关键文件**:
   - ✅ BH.h/BH.cpp：插件主入口
   - ✅ Config.h/Config.cpp：配置系统
   - ✅ Drawing/UI：用户界面系统
   - ✅ Modules/GameSettings：设置界面
   - ✅ UIString_Base.h：基础字符串定义
   - ✅ UIString_SC.h：简体中文字符串
   - ✅ UIString_TC.h：繁体中文字符串
   - ✅ build_both_versions.bat：命令行构建脚本
   - ✅ build_vs_shortcut.bat：Visual Studio集成构建脚本

2. **技术方案**:
   - ✅ 已选定方案A：创建两个独立的DLL文件（一个简体、一个繁体）
   - ❌ 方案B：创建单一DLL，内置语言切换功能（评估后认为实现难度较高）

3. **修改点分析**:
   - ✅ 创建两个版本的字符串资源
   - ✅ 设计编译时语言切换机制
   - ✅ 修改构建系统，支持两个版本的DLL生成
   - ✅ 修改所有直接使用硬编码字符串的地方

4. **构建流程**:
   - ✅ 使用Visual Studio的不同构建配置生成两个版本
   - ✅ 使用预处理器宏LANG_SC和LANG_TC区分不同版本
   - ✅ 构建脚本build_both_versions.bat可以自动生成两个版本
   - ✅ Visual Studio中可以通过配置管理器或批处理构建两个版本
   - ✅ 添加了Visual Studio外部工具配置，可一键构建两个版本

## 错误处理方案

1. **编译错误处理**:
   - 如果遇到头文件包含错误，请确保包含路径正确，特别是UIString_Base.h文件
   - 确保在所有使用字符串常量的地方都包含了UIString_Base.h

2. **文本显示问题**:
   - 如果文本显示乱码，检查源文件的编码是否为UTF-8
   - 确保游戏客户端支持中文字符集

3. **构建问题处理**:
   - 如果Visual Studio找不到MSBuild，请确保安装了Visual Studio生成工具
   - 如果build_vs_shortcut.bat无法在Visual Studio中运行，尝试使用完整路径或使用批处理解决方案方式构建
   - 如果遇到权限问题，尝试以管理员身份运行Visual Studio


